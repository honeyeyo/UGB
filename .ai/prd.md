# Product Requirements Document (PRD) for 乒乓球游戏菜单系统重设计

## Status: Draft

## Introduction

PongHub 是一款乒乓球游戏，当前存在场景分离和菜单体验不佳的问题。现有的 MainMenu 场景是独立的，无法与游戏场景共存，导致用户体验割裂。本项目旨在重新设计菜单系统，实现：

1. **统一场景体验**：启动游戏后直接进入 Local 单机场景，无需独立的菜单场景
2. **沉浸式菜单设计**：通过手柄 Menu 按键呼出的菜单 UI 平铺在球桌表面，避免遮挡视野
3. **无缝模式切换**：在单机和多人模式间无缝切换，共享 Gym 环境
4. **VR 优化交互**：专为 VR 环境设计的菜单交互方式

目标用户是 VR 乒乓球游戏玩家，项目将显著提升游戏的沉浸感和用户体验。

## Goals

- **提升用户体验**：消除场景切换的割裂感，提供连贯的游戏体验
- **优化 VR 交互**：设计符合 VR 特性的菜单系统，避免传统 2D 菜单的视野遮挡问题
- **简化启动流程**：游戏启动后直接进入可玩状态，减少等待时间
- **保持性能**：确保新菜单系统不影响游戏性能，特别是 VR 的帧率要求
- **兼容性保证**：新系统必须兼容现有的单机和多人游戏模式

### 成功指标

- 用户启动游戏到开始游戏的时间减少 50%
- 菜单操作的用户满意度提升
- 游戏性能稳定在 120fps（VR 要求）
- 支持所有现有游戏功能

## Features and Requirements

### 功能性需求

#### 核心菜单系统

- **桌面菜单 UI**：菜单界面平铺在球桌本方一侧表面
- **手柄菜单按键**：通过 VR 手柄的 Menu 按键呼出/隐藏菜单
- **模式切换**：支持单机练习、AI 对战、多人房间等模式切换
- **设置界面**：音频、视频、控制等设置选项

#### 场景管理

- **统一启动场景**：默认进入包含 Gym 环境的 Local 场景
- **环境共享**：单机和多人模式共享同一个 Gym 环境
- **组件状态切换**：根据模式动态启用/禁用相应组件

#### 输入系统整合

- **统一输入处理**：整合现有的 PongHubInputManager 和 PlayerInputController
- **菜单交互**：支持 VR 手柄的点击、悬停等交互方式
- **游戏内操作**：菜单显示时不影响基本的游戏操作

### 非功能性需求

#### 性能要求

- **VR 帧率**：维持 90fps 的稳定帧率
- **内存优化**：菜单系统内存占用<50MB
- **加载时间**：场景切换时间<2 秒

#### 用户体验

- **视野友好**：菜单不遮挡前方视野，特别是对手区域
- **直观操作**：VR 环境下的自然交互方式
- **视觉一致性**：与游戏整体美术风格保持一致

#### 兼容性

- **现有功能**：保持所有现有游戏功能
- **平台支持**：支持 Meta Quest 系列设备
- **向后兼容**：不破坏现有的存档和设置

### 技术约束

- 基于 Unity 引擎和现有的 PongHub 代码库
- 使用 Meta XR SDK 和 Unity XR Interaction Toolkit
- 保持现有的网络架构（Photon）

## Epic Structure

Epic-1: 场景架构重构 (Complete)
Epic-2: 桌面菜单 UI 系统 (Current)
Epic-3: 输入系统整合优化 (Future)
Epic-4: 性能优化和测试 (Future)

## Story List

### Epic-1: 场景架构重构

Story-1: 分析现有场景结构和菜单系统
Story-2: 设计统一场景架构方案
Story-3: 重构 Startup 场景为默认游戏场景
Story-4: 实现环境组件的动态模式切换
Story-5: 迁移 MainMenu 功能到游戏内菜单

### Epic-2: 桌面菜单 UI 系统

Story-6: 设计桌面菜单 UI 布局和交互
Story-7: 实现菜单 Canvas 在球桌表面的定位
Story-8: 开发 VR 手柄菜单按键处理
Story-9: 创建模式切换界面
Story-10: 实现设置菜单功能

### Epic-3: 输入系统整合优化

Story-11: 分析现有输入系统冲突
Story-12: 统一 PongHubInputManager 和 PlayerInputController
Story-13: 优化菜单状态下的输入处理
Story-14: 实现菜单和游戏输入的无缝切换

### Epic-4: 性能优化和测试

Story-15: VR 性能优化和帧率稳定
Story-16: 内存使用优化
Story-17: 用户体验测试和调优
Story-18: 兼容性测试和 bug 修复

## Tech Stack

### 语言和框架

- **C#**: Unity 脚本开发语言
- **Unity 2022.3 LTS**: 游戏引擎
- **Meta XR SDK**: VR 开发框架
- **Unity XR Interaction Toolkit**: VR 交互系统

### 网络和多人

- **Photon PUN2**: 多人网络解决方案
- **Unity Netcode**: 网络同步组件

### UI 和交互

- **Unity UI Toolkit**: 现代 UI 系统
- **XR UI Canvas**: VR 环境 UI 渲染
- **Input System**: Unity 新输入系统

## Future Enhancements

### 高级菜单功能

- **3D 菜单元素**：立体化的菜单组件
- **手势识别**：支持手势操作菜单
- **语音控制**：语音命令菜单导航
- **个性化定制**：用户自定义菜单布局

### 社交功能

- **好友系统**：游戏内好友列表和邀请
- **观战模式**：观看其他玩家比赛
- **回放系统**：比赛录像回放功能
- **社区功能**：排行榜、成就系统

### 高级游戏模式

- **锦标赛模式**：多轮比赛系统
- **训练营**：结构化的技能训练
- **挑战关卡**：特殊游戏挑战
- **自定义规则**：用户自定义比赛规则
