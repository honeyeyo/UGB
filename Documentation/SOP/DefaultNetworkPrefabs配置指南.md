# DefaultNetworkPrefabs é…ç½®æŒ‡å—

## æ¦‚è¿°

`DefaultNetworkPrefabs.asset` æ˜¯ **Unity Netcode for GameObjects** çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰å¯ä»¥åœ¨ç½‘ç»œä¼šè¯ä¸­åŠ¨æ€ç”Ÿæˆå’ŒåŒæ­¥çš„é¢„åˆ¶ä½“åˆ—è¡¨ã€‚è¿™ä¸ªæ–‡ä»¶å¯¹äºå¤šäºº VR ä¹’ä¹“çƒæ¸¸æˆè‡³å…³é‡è¦ã€‚

## æ–‡ä»¶ä½œç”¨

### 1. **ç½‘ç»œé¢„åˆ¶ä½“æ³¨å†Œè¡¨**

- åªæœ‰åœ¨æ­¤åˆ—è¡¨ä¸­æ³¨å†Œçš„é¢„åˆ¶ä½“æ‰èƒ½é€šè¿‡ `NetworkManager.Singleton.SpawnManager.SpawnNetworkObject()` æ–¹æ³•ç”Ÿæˆ
- ç¡®ä¿æ‰€æœ‰å®¢æˆ·ç«¯éƒ½æ‹¥æœ‰ç›¸åŒçš„é¢„åˆ¶ä½“å®šä¹‰å’Œæ ‡è¯†ç¬¦

### 2. **è·¨å®¢æˆ·ç«¯åŒæ­¥ä¿è¯**

- é€šè¿‡ GUID å’Œ Hash ç¡®ä¿æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„é¢„åˆ¶ä½“
- é˜²æ­¢å› é¢„åˆ¶ä½“ä¸åŒ¹é…å¯¼è‡´çš„ç½‘ç»œåŒæ­¥é”™è¯¯

### 3. **åŠ¨æ€å¯¹è±¡ç®¡ç†**

- æ”¯æŒåœ¨è¿è¡Œæ—¶ç”Ÿæˆå’Œé”€æ¯ç½‘ç»œå¯¹è±¡
- ç®¡ç†å¯¹è±¡çš„æ‰€æœ‰æƒè½¬ç§»å’ŒçŠ¶æ€åŒæ­¥

## æ‚¨çš„ä¹’ä¹“çƒ VR æ¸¸æˆé…ç½®

### å½“å‰é…ç½®è§£æ

> **âš ï¸ é‡è¦æé†’**: Unity çš„ `.asset` æ–‡ä»¶æ˜¯çº¯ YAML æ ¼å¼ï¼Œ**ä¸æ”¯æŒ `#` æ³¨é‡Š**ï¼
> ç›´æ¥åœ¨ `.asset` æ–‡ä»¶ä¸­æ·»åŠ æ³¨é‡Šä¼šå¯¼è‡´è§£æé”™è¯¯ã€‚
> æ³¨é‡Šä»…ç”¨äºæ­¤æ–‡æ¡£ä¸­çš„è¯´æ˜ç›®çš„ã€‚

**å®é™…æ–‡ä»¶å†…å®¹** (æ— æ³¨é‡Š):

```yaml
List:
  - Override: 0
    Prefab:
      {
        fileID: 4531446710466789163,
        guid: 9659024587d9c5946a05574857d30bdb,
        type: 3,
      }
  - Override: 0
    Prefab:
      {
        fileID: 6697775241635953393,
        guid: ae8adc48da668a243b09e965993d2c6d,
        type: 3,
      }
  - Override: 0
    Prefab:
      {
        fileID: 2983867211162582607,
        guid: faf18a0a765c8bd4982f73dca48b9189,
        type: 3,
      }
  - Override: 0
    Prefab:
      {
        fileID: 2245231018350186115,
        guid: 83e662091352a9f4ca84c40c9fa53958,
        type: 3,
      }
  # ... æ›´å¤šçƒé¢„åˆ¶ä½“
```

**é¢„åˆ¶ä½“åŠŸèƒ½è¯´æ˜**:

1. **NetworkSession** - æ ¸å¿ƒç½‘ç»œä¼šè¯ç®¡ç†
2. **PlayerAvatarEntity** - ç©å®¶ VR åŒ–èº«
3. **SpectatorNet** - è§‚ä¼—ç½‘ç»œå¯¹è±¡
4. **BallSpawner** - çƒç”Ÿæˆå™¨å’Œå¯¹è±¡æ± 
5. **ä¹’ä¹“çƒé¢„åˆ¶ä½“ä»¬** - 5 ç§ä¸åŒç±»å‹çš„çƒ

## æ ¸å¿ƒç½‘ç»œé¢„åˆ¶ä½“è¯¦è§£

### ğŸ¯ **å¿…é¡»åŒ…å«çš„é¢„åˆ¶ä½“**

#### 1. NetworkSession

- **ç”¨é€”**: ç½‘ç»œä¼šè¯ç®¡ç†
- **åŒ…å«ç»„ä»¶**: `NetworkBehaviour`, `NetworkObject`
- **é‡è¦æ€§**: â­â­â­â­â­ (æ ¸å¿ƒåŸºç¡€è®¾æ–½)

#### 2. PlayerAvatarEntity

- **ç”¨é€”**: VR ç©å®¶åŒ–èº«
- **åŒ…å«ç»„ä»¶**:
  - `PlayerControllerNetwork`
  - `AvatarEntity` (Meta Avatar)
  - `NetworkedTeam`
  - `RespawnController`
- **é‡è¦æ€§**: â­â­â­â­â­ (ç©å®¶è¡¨ç¤º)

#### 3. BallSpawner

- **ç”¨é€”**: ä¹’ä¹“çƒç®¡ç†ç³»ç»Ÿ
- **åŒ…å«ç»„ä»¶**:
  - `BallSpawner` (NetworkBehaviour)
  - `NetworkObjectPool`
- **é‡è¦æ€§**: â­â­â­â­â­ (æ¸¸æˆæ ¸å¿ƒ)

#### 4. ä¹’ä¹“çƒé¢„åˆ¶ä½“ä»¬

- **ç”¨é€”**: å¯ç½‘ç»œåŒæ­¥çš„ä¹’ä¹“çƒ
- **åŒ…å«ç»„ä»¶**:
  - `BallNetworking`
  - `BallStateSync`
  - `BallSpin`
  - `BallAttachment`
- **é‡è¦æ€§**: â­â­â­â­â­ (æ¸¸æˆå¯¹è±¡)

### ğŸ® **å¯é€‰åŒ…å«çš„é¢„åˆ¶ä½“**

#### 5. SpectatorNet

- **ç”¨é€”**: è§‚ä¼—ç³»ç»Ÿ
- **åŒ…å«ç»„ä»¶**: `SpectatorNetwork`
- **é‡è¦æ€§**: â­â­â­ (å¢å¼ºåŠŸèƒ½)

#### 6. çƒæ‹é¢„åˆ¶ä½“ (å¦‚æœåŠ¨æ€ç”Ÿæˆ)

- **ç”¨é€”**: ç½‘ç»œåŒæ­¥çš„çƒæ‹
- **åŒ…å«ç»„ä»¶**: `PaddleNetworking`
- **é‡è¦æ€§**: â­â­â­â­ (å¦‚æœæ”¯æŒåŠ¨æ€ç”Ÿæˆçƒæ‹)

## é…ç½®æœ€ä½³å®è·µ

### âœ… **åº”è¯¥åŒ…å«**

1. **æ‰€æœ‰åŠ¨æ€ç”Ÿæˆçš„å¯¹è±¡**

   ```csharp
   // è¿™äº›å¯¹è±¡éœ€è¦åœ¨è¿è¡Œæ—¶é€šè¿‡ç½‘ç»œç”Ÿæˆ
   NetworkManager.Singleton.SpawnManager.SpawnNetworkObject(ballPrefab);
   ```

2. **åŒ…å« NetworkBehaviour çš„é¢„åˆ¶ä½“**

   - æ‰€æœ‰ç»§æ‰¿è‡ª `NetworkBehaviour` çš„è„šæœ¬æ‰€åœ¨çš„é¢„åˆ¶ä½“

3. **è·¨åœºæ™¯æŒä¹…åŒ–å¯¹è±¡**
   - è®¾ç½®äº† `DontDestroyWithOwner = true` çš„å¯¹è±¡

### âŒ **ä¸åº”è¯¥åŒ…å«**

1. **é™æ€åœºæ™¯å¯¹è±¡**

   - æ¡Œå­ã€å¢™å£ã€è£…é¥°ç‰©ç­‰å›ºå®šç¯å¢ƒ
   - è¿™äº›å¯¹è±¡åº”è¯¥ç›´æ¥æ”¾ç½®åœ¨åœºæ™¯ä¸­

2. **çº¯æœ¬åœ°å¯¹è±¡**

   - UI å…ƒç´ ã€éŸ³æ•ˆæ’­æ”¾å™¨ã€è§†è§‰ç‰¹æ•ˆç­‰
   - ä¸éœ€è¦ç½‘ç»œåŒæ­¥çš„å¯¹è±¡

3. **é‡å¤çš„é¢„åˆ¶ä½“å˜ç§**
   - é™¤éæœ‰æ˜ç¡®çš„ç½‘ç»œåŒæ­¥éœ€æ±‚

## å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### Q1: "Parser Failure" YAML è§£æé”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `Unable to parse file Assets/DefaultNetworkPrefabs.asset: [Parser Failure at line X: Expect ':' between key and value within mapping]`

**åŸå› **: Unity çš„ `.asset` æ–‡ä»¶ä¸æ”¯æŒ `#` æ³¨é‡Š
**è§£å†³**:

```csharp
// âŒ é”™è¯¯ - ä¸è¦åœ¨ .asset æ–‡ä»¶ä¸­æ·»åŠ æ³¨é‡Š
List:
  # è¿™æ˜¯æ³¨é‡Š - ä¼šå¯¼è‡´è§£æé”™è¯¯ï¼
  - Override: 0

// âœ… æ­£ç¡® - çº¯å‡€çš„ YAML æ ¼å¼
List:
  - Override: 0
    Prefab: {fileID: xxx, guid: xxx, type: 3}
```

### Q2: "NetworkPrefab cannot be null" é”™è¯¯

**åŸå› **: åˆ—è¡¨ä¸­å­˜åœ¨æ— æ•ˆçš„é¢„åˆ¶ä½“å¼•ç”¨
**è§£å†³**: æ¸…ç†ç©ºå¼•ç”¨ï¼Œç¡®ä¿æ‰€æœ‰ GUID éƒ½æŒ‡å‘æœ‰æ•ˆé¢„åˆ¶ä½“

### Q2: çƒæ— æ³•ç”Ÿæˆ

**åŸå› **: çƒé¢„åˆ¶ä½“æœªåœ¨åˆ—è¡¨ä¸­æ³¨å†Œ
**è§£å†³**: ç¡®ä¿æ‰€æœ‰ `BallSpawner` ä¸­å¼•ç”¨çš„çƒé¢„åˆ¶ä½“éƒ½åœ¨åˆ—è¡¨ä¸­

### Q3: ç©å®¶å¤´åƒä¸åŒæ­¥

**åŸå› **: `PlayerAvatarEntity` é¢„åˆ¶ä½“é…ç½®é”™è¯¯
**è§£å†³**: æ£€æŸ¥é¢„åˆ¶ä½“æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…è¦çš„ç½‘ç»œç»„ä»¶

### Q4: å¯¹è±¡æ± ä¸­çš„é¢„åˆ¶ä½“æ— æ³•ä½¿ç”¨

**åŸå› **: å¯¹è±¡æ± ä¸­çš„é¢„åˆ¶ä½“ä¹Ÿéœ€è¦æ³¨å†Œåˆ°ç½‘ç»œé¢„åˆ¶ä½“åˆ—è¡¨
**è§£å†³**: å°† `NetworkObjectPool` ä¸­çš„æ‰€æœ‰é¢„åˆ¶ä½“éƒ½æ·»åŠ åˆ°åˆ—è¡¨

## è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨ç½‘ç»œè°ƒè¯•æ—¥å¿—

```csharp
// åœ¨ NetworkManager ä¸Šå¯ç”¨è¯¦ç»†æ—¥å¿—
NetworkManager.Singleton.LogLevel = LogLevel.Developer;
```

### 2. æ£€æŸ¥é¢„åˆ¶ä½“å“ˆå¸Œå€¼

```csharp
// éªŒè¯é¢„åˆ¶ä½“æ˜¯å¦æ­£ç¡®æ³¨å†Œ
foreach (var prefab in NetworkManager.Singleton.NetworkConfig.Prefabs.m_Prefabs)
{
    Debug.Log($"Registered: {prefab.Prefab.name} - Hash: {prefab.Hash}");
}
```

### 3. è¿è¡Œæ—¶éªŒè¯

```csharp
// æ£€æŸ¥å¯¹è±¡æ˜¯å¦å¯ä»¥ç”Ÿæˆ
bool canSpawn = NetworkManager.Singleton.SpawnManager.CanSpawn(prefab);
Debug.Log($"Can spawn {prefab.name}: {canSpawn}");
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. é™åˆ¶é¢„åˆ¶ä½“æ•°é‡

- åªæ³¨å†ŒçœŸæ­£éœ€è¦ç½‘ç»œç”Ÿæˆçš„é¢„åˆ¶ä½“
- è¿‡å¤šçš„é¢„åˆ¶ä½“ä¼šå¢åŠ ç½‘ç»œæ¡æ‰‹æ—¶é—´

### 2. ä½¿ç”¨å¯¹è±¡æ± 

- é¢‘ç¹ç”Ÿæˆ/é”€æ¯çš„å¯¹è±¡ï¼ˆå¦‚ä¹’ä¹“çƒï¼‰åº”ä½¿ç”¨ `NetworkObjectPool`
- å‡å°‘å†…å­˜åˆ†é…å’Œç½‘ç»œæ¶ˆæ¯æ•°é‡

### 3. é¢„åˆ¶ä½“ç‰ˆæœ¬ç®¡ç†

- ç¡®ä¿æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„é¢„åˆ¶ä½“
- ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†é¢„åˆ¶ä½“å˜æ›´

## æ€»ç»“

`DefaultNetworkPrefabs.asset` æ˜¯ä¹’ä¹“çƒ VR æ¸¸æˆç½‘ç»œæ¶æ„çš„åŸºçŸ³ã€‚æ­£ç¡®é…ç½®æ­¤æ–‡ä»¶å¯ä»¥ï¼š

- âœ… ç¡®ä¿æ‰€æœ‰ç½‘ç»œå¯¹è±¡æ­£å¸¸ç”Ÿæˆå’ŒåŒæ­¥
- âœ… é¿å… "NetworkPrefab cannot be null" ç­‰é”™è¯¯
- âœ… æ”¯æŒåŠ¨æ€çƒæ‹ã€ä¹’ä¹“çƒå’Œç©å®¶ç®¡ç†
- âœ… æä¾›æµç•…çš„å¤šäºº VR æ¸¸æˆä½“éªŒ

å½“å‰é…ç½®å·²ç»åŒ…å«äº†ä¹’ä¹“çƒ VR æ¸¸æˆçš„æ‰€æœ‰æ ¸å¿ƒç½‘ç»œé¢„åˆ¶ä½“ï¼Œå¯ä»¥æ”¯æŒå®Œæ•´çš„å¤šäººå¯¹æˆ˜åŠŸèƒ½ã€‚
