# PongHub è¾“å…¥ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“‹ **ç³»ç»Ÿæ¦‚è¿°**

PongHub è¾“å…¥ç³»ç»ŸåŸºäº Unity Input System æ„å»ºï¼Œæä¾›å®Œæ•´çš„ VR ä¹’ä¹“çƒæ¸¸æˆäº¤äº’ä½“éªŒã€‚ç³»ç»ŸåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

- **PongHubInputManager**: ä¸»è¾“å…¥ç®¡ç†å™¨
- **PlayerHeightController**: é«˜åº¦è°ƒæ•´æ§åˆ¶å™¨
- **TeleportController**: ä¼ é€æ§åˆ¶å™¨
- **ServeBallController**: å‘çƒæ§åˆ¶å™¨
- **PaddleController**: çƒæ‹æ§åˆ¶å™¨

## ğŸš€ **å¿«é€Ÿè®¾ç½®**

### 1. é¡¹ç›®çº§é…ç½®

**è®¾ç½®é»˜è®¤è¾“å…¥åŠ¨ä½œ**ï¼š

1. æ‰“å¼€ `Edit > Project Settings`
2. é€‰æ‹© `Input System Package`
3. åœ¨ `Default Input Actions` å­—æ®µä¸­é€‰æ‹© `PongHub.inputactions`

### 2. åœºæ™¯ç»„ä»¶é…ç½®

#### â­ **æ¨èæ–¹å¼ï¼šåœ¨ Startup åœºæ™¯é…ç½®**

**ä¸ºä»€ä¹ˆé€‰æ‹© Startup åœºæ™¯ï¼Ÿ**

- é¡¹ç›®å·²æœ‰å®Œå–„çš„ç®¡ç†å™¨æŒä¹…åŒ–æ¶æ„
- Startup â†’ MainMenu â†’ Gym çš„åŠ è½½é¡ºåº
- ä¸å…¶ä»–ç®¡ç†å™¨ï¼ˆAudioManagerã€UIManager ç­‰ï¼‰ä¿æŒä¸€è‡´

**é…ç½®æ­¥éª¤ï¼š**

1. **æ‰“å¼€ Startup åœºæ™¯**

   ```text
   åŒå‡»ï¼šAssets/PongHub/Scenes/Startup.unity
   ```

2. **åˆ›å»º InputManager**

   ```text
   Hierarchy â†’ å³é”® â†’ Create Empty â†’ å‘½å "InputManager"
   ```

3. **æ·»åŠ æ ¸å¿ƒç»„ä»¶**

   ```csharp
   // å¿…éœ€ç»„ä»¶
   PongHubInputManager (æ ¸å¿ƒ)
   PlayerHeightController
   TeleportController
   ServeBallController
   PaddleController
   ```

4. **é…ç½®ä¸ºé¢„åˆ¶ä»¶ï¼ˆå¯é€‰ï¼‰**

   ```text
   å°†é…ç½®å®Œæˆçš„ InputManager æ‹–åˆ° Project é¢æ¿åˆ›å»ºé¢„åˆ¶ä»¶
   åœ¨ SceneManagerChecker ä¸­æŒ‡å®šè¯¥é¢„åˆ¶ä»¶
   ```

#### ğŸ”„ **è·¨åœºæ™¯æŒä¹…åŒ–æœºåˆ¶**

**è‡ªåŠ¨æŒä¹…åŒ–**ï¼š

```csharp
// PongHubInputManager å·²å®ç° DontDestroyOnLoad
private void Awake()
{
    if (Instance == null)
    {
        Instance = this;
        DontDestroyOnLoad(gameObject); // ğŸ”‘ å…³é”®ï¼
        InitializeInputActions();
    }
    else
    {
        Destroy(gameObject); // é˜²æ­¢é‡å¤åˆ›å»º
    }
}
```

**åœºæ™¯æµè½¬**ï¼š

```text
Startup.unity (åˆ›å»ºInputManager)
    â†“ DontDestroyOnLoad
MainMenu.unity (InputManagerå­˜åœ¨)
    â†“ DontDestroyOnLoad
Gym.unity (InputManagerå­˜åœ¨)
```

**éªŒè¯æ–¹æ³•**ï¼š

```csharp
// åœ¨ä»»ä½•åœºæ™¯ä¸­éªŒè¯
if (PongHubInputManager.Instance != null)
{
    Debug.Log("InputManager æ­£å¸¸å·¥ä½œï¼");
}
```

### 3. å¿…éœ€çš„å¼•ç”¨è®¾ç½®

#### PongHubInputManager è®¾ç½®

- **Input Actions**: æŒ‡å®š `PongHub.inputactions` æ–‡ä»¶
- **Player Rig**: VR æ‘„åƒæœºæ ¹èŠ‚ç‚¹ï¼ˆå¦‚ OVRCameraRigï¼‰
- **Left/Right Hand Anchor**: VR æ§åˆ¶å™¨é”šç‚¹
- **Move Speed**: ç§»åŠ¨é€Ÿåº¦ï¼ˆæ¨è 3.0ï¼‰
- **Dead Zone**: æ‘‡æ†æ­»åŒºï¼ˆæ¨è 0.1ï¼‰

#### PlayerHeightController è®¾ç½®

- **Height Speed**: è°ƒæ•´é€Ÿåº¦ï¼ˆ0.01 = 1cm/sï¼‰
- **Min/Max Height Offset**: é«˜åº¦é™åˆ¶èŒƒå›´
- **Player Rig**: ä¸ InputManager ç›¸åŒ
- **Height Indicator UI**: å¯é€‰çš„ UI åé¦ˆå…ƒç´ 

#### TeleportController è®¾ç½®

- **Teleport Distance**: æœ€å¤§ä¼ é€è·ç¦»ï¼ˆ10mï¼‰
- **Snap Turn Angle**: å¿«é€Ÿè½¬å‘è§’åº¦ï¼ˆ45 åº¦ï¼‰
- **Teleport Layer Mask**: å¯ä¼ é€è¡¨é¢å±‚
- **Valid/Invalid Materials**: ä¼ é€å°„çº¿æè´¨

#### ServeBallController è®¾ç½®

- **Ball Prefab**: ä¹’ä¹“çƒé¢„åˆ¶ä»¶
- **Max Active Balls**: æœ€å¤§æ´»è·ƒçƒæ•°ï¼ˆ3 ä¸ªï¼‰
- **Ball Lifetime**: çƒå­˜åœ¨æ—¶é—´ï¼ˆ30 ç§’ï¼‰
- **Ball Physics Material**: çƒä½“ç‰©ç†æè´¨

#### PaddleController è®¾ç½®

- **Left/Right Paddle Prefab**: çƒæ‹é¢„åˆ¶ä»¶
- **Grip Distance**: æŠ“å–è·ç¦»ï¼ˆ0.1mï¼‰
- **Use Physics Joint**: æ˜¯å¦ä½¿ç”¨ç‰©ç†å…³èŠ‚
- **Follow/Rotation Speed**: è·Ÿéšé€Ÿåº¦å‚æ•°

## ğŸ® **æ§åˆ¶æ˜ å°„è¯¦æƒ…**

### Quest æ§åˆ¶å™¨æ˜ å°„

| ä½ç½®      | æ§ä»¶      | åŠŸèƒ½      | è¯´æ˜               |
| --------- | --------- | --------- | ------------------ |
| å·¦æ‰‹æ‘‡æ†  | 2D è½´     | ç§»åŠ¨      | å‰åå·¦å³å¹³ç§»       |
| å·¦æ‰‹ Grip | æŒ‰é’®      | çƒæ‹æŠ“å–  | æŠ“å–å·¦æ‰‹çƒæ‹       |
| å·¦æ‰‹æ‰³æœº  | æŒ‰é’®      | å‘çƒ      | ä»…éæŒæ‹æ—¶å¯ç”¨     |
| å·¦æ‰‹ X é”® | é•¿æŒ‰      | å‡é«˜      | 1cm/s è°ƒæ•´é€Ÿåº¦     |
| å·¦æ‰‹ Y é”® | é•¿æŒ‰      | é™ä½      | 1cm/s è°ƒæ•´é€Ÿåº¦     |
| å·¦æ‰‹ Menu | æŒ‰é’®      | èœå•      | æ¸¸æˆèœå•åˆ‡æ¢       |
| å³æ‰‹æ‘‡æ†  | 2D è½´     | ä¼ é€+è½¬å‘ | Y è½´ä¼ é€ï¼ŒX è½´è½¬å‘ |
| å³æ‰‹ Grip | æŒ‰é’®      | çƒæ‹æŠ“å–  | æŠ“å–å³æ‰‹çƒæ‹       |
| å³æ‰‹æ‰³æœº  | æŒ‰é’®      | å‘çƒ      | ä»…éæŒæ‹æ—¶å¯ç”¨     |
| å³æ‰‹ A é”® | æŒ‰é’®      | æš‚åœ      | å•æœºæ¨¡å¼æš‚åœ       |
| å³æ‰‹ Meta | é•¿æŒ‰ 2 ç§’ | é‡ç½®ä½ç½®  | é‡ç½®ç©å®¶ä½ç½®       |

### å‘çƒé€»è¾‘è§„åˆ™

1. **æŒæ‹æ£€æŸ¥**: åªæœ‰éæŒæ‹æ‰‹æ‰èƒ½å‘çƒ
2. **è·ç¦»æ£€æŸ¥**: æ‰‹éƒ¨ä¸çƒæ‹è·ç¦»éœ€åœ¨åˆç†èŒƒå›´å†…
3. **æ•°é‡é™åˆ¶**: åŒæ—¶æœ€å¤š 3 ä¸ªæ´»è·ƒçƒä½“
4. **è‡ªåŠ¨æ¸…ç†**: çƒä½“ 30 ç§’åè‡ªåŠ¨é”€æ¯

## ğŸ“ **ä»£ç ä½¿ç”¨ç¤ºä¾‹**

### ç›‘å¬è¾“å…¥äº‹ä»¶

```csharp
using PongHub.Input;

public class GameController : MonoBehaviour
{
    private void OnEnable()
    {
        // ç›‘å¬çƒæ‹äº‹ä»¶
        PongHubInputManager.OnPaddleGripped += HandlePaddleGripped;
        PongHubInputManager.OnPaddleReleased += HandlePaddleReleased;

        // ç›‘å¬å‘çƒäº‹ä»¶
        PongHubInputManager.OnServeBallGenerated += HandleServeBall;

        // ç›‘å¬ç³»ç»Ÿäº‹ä»¶
        PongHubInputManager.OnMenuToggled += HandleMenuToggle;
        PongHubInputManager.OnGamePaused += HandleGamePause;
        PongHubInputManager.OnPositionReset += HandlePositionReset;
    }

    private void OnDisable()
    {
        // å–æ¶ˆç›‘å¬
        PongHubInputManager.OnPaddleGripped -= HandlePaddleGripped;
        // ... å…¶ä»–å–æ¶ˆç›‘å¬
    }

    private void HandlePaddleGripped(bool isLeftHand)
    {
        Debug.Log($"{(isLeftHand ? "å·¦" : "å³")}æ‰‹çƒæ‹å·²æŠ“å–");
    }

    private void HandleServeBall(bool isLeftHand)
    {
        Debug.Log($"{(isLeftHand ? "å·¦" : "å³")}æ‰‹å‘çƒ");
    }
}
```

### è·å–è¾“å…¥çŠ¶æ€

```csharp
// è·å–å½“å‰è¾“å…¥çŠ¶æ€
PongHubInputManager inputManager = PongHubInputManager.Instance;

// æ£€æŸ¥çƒæ‹çŠ¶æ€
bool isLeftGripped = inputManager.IsLeftPaddleGripped;
bool isRightGripped = inputManager.IsRightPaddleGripped;

// è·å–ç§»åŠ¨è¾“å…¥
Vector2 moveInput = inputManager.CurrentMoveInput;

// è·å–ä¼ é€è¾“å…¥
Vector2 teleportInput = inputManager.CurrentTeleportInput;
```

### æ§åˆ¶å­ç³»ç»Ÿ

```csharp
// é«˜åº¦æ§åˆ¶
PlayerHeightController heightController = FindObjectOfType<PlayerHeightController>();
heightController.SetHeightOffset(0.2f); // è®¾ç½®20cmé«˜åº¦åç§»
float currentHeight = heightController.CurrentHeightOffsetCm; // è·å–å½“å‰é«˜åº¦

// ä¼ é€æ§åˆ¶
TeleportController teleportController = FindObjectOfType<TeleportController>();
teleportController.SetTeleportDistance(15f); // è®¾ç½®æœ€å¤§ä¼ é€è·ç¦»
teleportController.ForceCancelTeleport(); // å¼ºåˆ¶å–æ¶ˆä¼ é€

// å‘çƒæ§åˆ¶
ServeBallController serveBallController = FindObjectOfType<ServeBallController>();
int activeBalls = serveBallController.GetActiveBallCount(); // è·å–æ´»è·ƒçƒæ•°
serveBallController.ClearAllBalls(); // æ¸…ç†æ‰€æœ‰çƒ

// çƒæ‹æ§åˆ¶
PaddleController paddleController = FindObjectOfType<PaddleController>();
GameObject leftPaddle = paddleController.GetPaddleInstance(true); // è·å–å·¦æ‰‹çƒæ‹
paddleController.ResetPaddlePositions(); // é‡ç½®çƒæ‹ä½ç½®
```

## ğŸ›  **é«˜çº§é…ç½®**

### è‡ªå®šä¹‰è¾“å…¥åŠ¨ä½œ

1. æ‰“å¼€ `PongHub.inputactions` æ–‡ä»¶
2. åœ¨ Unity Input Actions ç¼–è¾‘å™¨ä¸­ä¿®æ”¹ç»‘å®š
3. é‡æ–°ç”Ÿæˆä»£ç ï¼ˆå¦‚æœä½¿ç”¨ Generate C# Class é€‰é¡¹ï¼‰
4. æ›´æ–° PongHubInputManager ä¸­çš„åŠ¨ä½œå¼•ç”¨

### æ·»åŠ æ–°çš„è¾“å…¥åŠ¨ä½œ

```csharp
// åœ¨PongHubInputManagerä¸­æ·»åŠ æ–°åŠ¨ä½œ
private InputAction m_newCustomAction;

private void InitializeInputActions()
{
    // ... ç°æœ‰ä»£ç  ...
    m_newCustomAction = m_playerActions.FindAction("NewCustomAction");
}

private void BindInputEvents()
{
    // ... ç°æœ‰ä»£ç  ...
    m_newCustomAction.performed += OnNewCustomActionPerformed;
}

private void OnNewCustomActionPerformed(InputAction.CallbackContext context)
{
    // å¤„ç†æ–°åŠ¨ä½œ
    Debug.Log("æ–°è‡ªå®šä¹‰åŠ¨ä½œè¢«è§¦å‘");
}
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¯¹è±¡æ± ä½¿ç”¨**: ServeBallController å·²å®ç°çƒä½“å¯¹è±¡æ± 
2. **äº‹ä»¶è§£ç»‘**: ç¡®ä¿åœ¨ OnDisable ä¸­æ­£ç¡®è§£ç»‘æ‰€æœ‰äº‹ä»¶
3. **ç‰©ç†ä¼˜åŒ–**: å¯é€‰æ‹©å…³é—­ç‰©ç†å…³èŠ‚ä½¿ç”¨éç‰©ç†è·Ÿéš
4. **éŸ³æ•ˆç®¡ç†**: åˆç†ä½¿ç”¨ AudioSource é¿å…è¿‡åº¦æ’­æ”¾

## ğŸ› **å¸¸è§é—®é¢˜è§£å†³**

### é—®é¢˜ 1: æ‰¾ä¸åˆ° Player Rig

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿åœºæ™¯ä¸­æœ‰åä¸º"OVRCameraRig"ã€"XR Rig"æˆ–"CameraRig"çš„ GameObject

### é—®é¢˜ 2: çƒæ‹æ— æ³•æŠ“å–

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥çƒæ‹é¢„åˆ¶ä»¶æ˜¯å¦æ­£ç¡®è®¾ç½®
- ç¡®è®¤æ‰‹éƒ¨é”šç‚¹ä½ç½®æ­£ç¡®
- è°ƒæ•´æŠ“å–è·ç¦»å‚æ•°

### é—®é¢˜ 3: ä¼ é€æ— æ³•å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥ä¼ é€å±‚çº§è®¾ç½®
- ç¡®è®¤åœ°é¢ GameObject åœ¨æ­£ç¡®å±‚çº§
- éªŒè¯ä¼ é€æè´¨æ˜¯å¦æŒ‡å®š

### é—®é¢˜ 4: é«˜åº¦è°ƒæ•´æ— å“åº”

**è§£å†³æ–¹æ¡ˆ**:

- ç¡®è®¤ Player Rig å¼•ç”¨æ­£ç¡®
- æ£€æŸ¥è¾“å…¥åŠ¨ä½œç»‘å®šæ˜¯å¦æ­£ç¡®
- éªŒè¯ Hold äº¤äº’è®¾ç½®

### é—®é¢˜ 5: è·¨åœºæ™¯å¼•ç”¨ä¸¢å¤±

**åŸå› **: VR Camera Rig åœ¨ä¸åŒåœºæ™¯ä¸­å¯èƒ½ä¸åŒ

**è§£å†³æ–¹æ¡ˆ**:

```csharp
// åœ¨ PongHubInputManager ä¸­æ·»åŠ è‡ªåŠ¨æŸ¥æ‰¾
private void Start()
{
    if (m_playerRig == null)
    {
        // è‡ªåŠ¨æŸ¥æ‰¾å¸¸è§çš„VR Rigåç§°
        GameObject vrRig = GameObject.Find("OVRCameraRig")
                        ?? GameObject.Find("XR Rig")
                        ?? GameObject.Find("CameraRig");
        if (vrRig != null)
        {
            m_playerRig = vrRig.transform;
            UpdateHandAnchors();
        }
    }
}
```

### é—®é¢˜ 6: åœ¨æŸäº›åœºæ™¯è¾“å…¥ä¸å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥ Event System æ˜¯å¦å­˜åœ¨
- ç¡®è®¤åœºæ™¯ä¸­æ²¡æœ‰ç¦ç”¨è¾“å…¥çš„è„šæœ¬
- éªŒè¯ XR è®¾ç½®æ˜¯å¦æ­£ç¡®åŠ è½½

## ğŸ“š **ç›¸å…³æ–‡æ¡£**

- [è¾“å…¥ç³»ç»Ÿè®¾è®¡æ–‡æ¡£](./è¾“å…¥ç³»ç»Ÿè®¾è®¡æ–‡æ¡£.md)
- [çƒæ‹å’Œä¹’ä¹“çƒç½‘ç»œåŒæ­¥æŠ€æœ¯æ–‡æ¡£](./çƒæ‹å’Œä¹’ä¹“çƒç½‘ç»œåŒæ­¥æŠ€æœ¯æ–‡æ¡£.md)
- [Unity Input System å®˜æ–¹æ–‡æ¡£](https://docs.unity3d.com/Packages/com.unity.inputsystem@1.0/manual/index.html)

## ğŸ”„ **ç‰ˆæœ¬å†å²**

### v1.0.0 (å½“å‰ç‰ˆæœ¬)

- âœ… å®Œæ•´çš„ VR æ§åˆ¶å™¨è¾“å…¥æ”¯æŒ
- âœ… çƒæ‹æŠ“å–å’Œé‡Šæ”¾ç³»ç»Ÿ
- âœ… éæŒæ‹æ‰‹å‘çƒé€»è¾‘
- âœ… ä¼ é€å’Œå¿«é€Ÿè½¬å‘ç³»ç»Ÿ
- âœ… ç²¾ç¡®é«˜åº¦è°ƒæ•´åŠŸèƒ½
- âœ… å®Œæ•´çš„éŸ³æ•ˆåé¦ˆç³»ç»Ÿ
- âœ… äº‹ä»¶é©±åŠ¨çš„æ¶æ„è®¾è®¡

### è®¡åˆ’åŠŸèƒ½

- ğŸ”„ æ‰‹åŠ¿è¯†åˆ«å¢å¼º
- ğŸ”„ åŠ›åé¦ˆæ”¯æŒ
- ğŸ”„ æ›´å¤šè‡ªå®šä¹‰é€‰é¡¹
- ğŸ”„ ç½‘ç»œåŒæ­¥ä¼˜åŒ–
