# ç¯å¢ƒå…±äº«å’Œæ— ç¼æ¨¡å¼åˆ‡æ¢æŒ‡å—

## ğŸ¯ æ ¸å¿ƒç†å¿µ

**é—®é¢˜**ï¼šä¸åº”è¯¥åªå¤åˆ¶ TTï¼ˆçƒæ¡Œï¼‰ï¼Œè€Œåº”è¯¥å¤åˆ¶å®Œæ•´çš„ Environment æä¾›æ²‰æµ¸å¼ä½“éªŒï¼ŒåŒæ—¶é¿å…é‡å¤åˆå§‹åŒ–ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šç¯å¢ƒå¤ç”¨ + ç»„ä»¶çŠ¶æ€åˆ‡æ¢æ¶æ„

## ğŸ—ï¸ å®Œæ•´å®æ–½æ–¹æ¡ˆ

### ç¬¬ä¸€é˜¶æ®µï¼šåˆ›å»ºå…±äº«ç¯å¢ƒé¢„åˆ¶ä½“

#### 1. æå– Gym ç¯å¢ƒç»“æ„

```bash
âœ… å·²å®Œæˆï¼šSharedEnvironment.prefab å·²åˆ›å»ºï¼ŒåŒ…å«ä»¥ä¸‹å®é™…ç»“æ„ï¼š

   ğŸ“ SharedEnvironment (root)
   â”œâ”€â”€ ğŸ—ï¸ Architecture                 // å»ºç­‘ç»“æ„
   â”œâ”€â”€ ğŸ‹ï¸ Gym Equipment               // ä½“è‚²å™¨æ
   â”‚   â”œâ”€â”€ Bench (é•¿æ¤…)
   â”‚   â”œâ”€â”€ Brus (åŒæ )
   â”‚   â”œâ”€â”€ Ladder (æ¢¯å­)
   â”‚   â”œâ”€â”€ Mattress (å«å­)
   â”‚   â”œâ”€â”€ Rack (æ¶å­)
   â”‚   â”œâ”€â”€ VaultingHorse (è·³é©¬)
   â”‚   â””â”€â”€ Trampline (è¹¦åºŠ)
   â”œâ”€â”€ ğŸ’¡ Lighting System             // ç¯å…‰ç³»ç»Ÿ
   â”‚   â”œâ”€â”€ Directional Light
   â”‚   â”œâ”€â”€ AreaLights (åŒºåŸŸç¯ç»„)
   â”‚   â””â”€â”€ Light Probe Group
   â”œâ”€â”€ ğŸ”Š Audio Systems               // éŸ³é¢‘ç³»ç»Ÿ
   â”‚   â”œâ”€â”€ MusicManager
   â”‚   â””â”€â”€ centerAudioSource
   â”œâ”€â”€ ğŸ¨ Post Processing             // åå¤„ç†æ•ˆæœ
   â”‚   â””â”€â”€ Global Volume
   â”œâ”€â”€ ğŸš§ Collision Boundaries        // ç¢°æ’è¾¹ç•Œ
   â”œâ”€â”€ ğŸª‘ Furniture                   // å®¶å…·
   â”œâ”€â”€ ğŸšª Gates & Doors               // é—¨å’Œå…¥å£
   â”œâ”€â”€ âš™ï¸ Technical                   // æŠ€æœ¯è®¾å¤‡
   â”‚   â”œâ”€â”€ Radiator (æ•£çƒ­å™¨)
   â”‚   â””â”€â”€ LightLum (ç…§æ˜è®¾å¤‡)
   â””â”€â”€ ğŸ—ºï¸ NavMeshPlane               // å¯¼èˆªç½‘æ ¼
```

#### 2. é¢„åˆ¶ä½“é…ç½®

```bash
âœ… å·²å®Œæˆï¼šSharedEnvironment.prefab
â”œâ”€â”€ ğŸ“ ä½ç½®ï¼šAssets/PongHub/Prefabs/SharedEnvironment.prefab
â”œâ”€â”€ ğŸ—ï¸ çŠ¶æ€ï¼šå·²åˆ›å»ºå¹¶åŒ…å«å®Œæ•´Gymç¯å¢ƒ
â”œâ”€â”€ âš™ï¸ é…ç½®ï¼šåŒ…å«æ‰€æœ‰å¿…è¦çš„ç¯å¢ƒç»„ä»¶
â””â”€â”€ ğŸ¯ ç”¨é€”ï¼šå¯ç›´æ¥åœ¨Startupåœºæ™¯ä¸­ä½¿ç”¨
```

**é¢„åˆ¶ä½“ç‰¹æ€§ï¼š**

- âœ… å®Œæ•´çš„ä½“è‚²é¦†ç¯å¢ƒ
- âœ… ç‹¬ç«‹çš„éŸ³é¢‘å’Œç¯å…‰ç³»ç»Ÿ
- âœ… ç¢°æ’è¾¹ç•Œå’Œå¯¼èˆªç½‘æ ¼
- âœ… æ‰€æœ‰è£…é¥°æ€§ç¯å¢ƒå…ƒç´ 

### ç¬¬äºŒé˜¶æ®µï¼šé‡æ„åœºæ™¯ç»“æ„

#### 1. Startup åœºæ™¯é‡æ„

```text
Startup Scene æ¨èç»“æ„ï¼š
â”œâ”€â”€ ğŸ¢ SharedEnvironment (é¢„åˆ¶ä½“å®ä¾‹)
â”‚   â”œâ”€â”€ Architecture (å»ºç­‘ç»“æ„)
â”‚   â”œâ”€â”€ Gym Equipment (ä½“è‚²å™¨æ)
â”‚   â”œâ”€â”€ Lighting System (ç¯å…‰ç³»ç»Ÿ)
â”‚   â”œâ”€â”€ Audio Systems (éŸ³é¢‘ç³»ç»Ÿ)
â”‚   â”œâ”€â”€ Post Processing (åå¤„ç†)
â”‚   â”œâ”€â”€ Collision Boundaries (ç¢°æ’è¾¹ç•Œ)
â”‚   â”œâ”€â”€ Furniture (å®¶å…·)
â”‚   â”œâ”€â”€ Gates & Doors (é—¨)
â”‚   â”œâ”€â”€ Technical (æŠ€æœ¯è®¾å¤‡)
â”‚   â””â”€â”€ NavMeshPlane (å¯¼èˆªç½‘æ ¼)
â”‚
â”œâ”€â”€ ğŸ® Game Area (å¯åˆ‡æ¢æ¨¡å¼)
â”‚   â”œâ”€â”€ GameModeManager (æ ¸å¿ƒç®¡ç†å™¨)
â”‚   â”œâ”€â”€ Table (åŒæ¨¡å¼ç»„ä»¶)
â”‚   â”‚   â”œâ”€â”€ Table (åŸºç¡€ç»„ä»¶)
â”‚   â”‚   â”œâ”€â”€ TableLocalController (å•æœºæ§åˆ¶)
â”‚   â”‚   â””â”€â”€ TableNetworkController (ç½‘ç»œæ§åˆ¶ï¼Œåˆå§‹ç¦ç”¨)
â”‚   â”œâ”€â”€ Ball System (åŒæ¨¡å¼)
â”‚   â”‚   â”œâ”€â”€ BallPhysics (åŸºç¡€ç‰©ç†)
â”‚   â”‚   â”œâ”€â”€ BallLocalManager (å•æœºç®¡ç†)
â”‚   â”‚   â””â”€â”€ BallNetworkManager (ç½‘ç»œç®¡ç†ï¼Œåˆå§‹ç¦ç”¨)
â”‚   â””â”€â”€ Paddle System (åŒæ¨¡å¼)
â”‚       â”œâ”€â”€ LocalPaddles (å•æœºçƒæ‹)
â”‚       â””â”€â”€ NetworkPaddles (ç½‘ç»œçƒæ‹ï¼Œåˆå§‹ç¦ç”¨)
â”‚
â””â”€â”€ ğŸ›ï¸ Application Systems (åº”ç”¨ç³»ç»Ÿ)
    â”œâ”€â”€ PHApplication
    â”œâ”€â”€ NetworkLayer
    â”œâ”€â”€ AudioManager
    â””â”€â”€ UI Systems
```

#### 2. Gym åœºæ™¯é‡æ„

```text
Gym Scene æ–°ç»“æ„ï¼š
â”œâ”€â”€ ğŸ¢ SharedEnvironment (ç›¸åŒé¢„åˆ¶ä½“å®ä¾‹)
â”‚   â””â”€â”€ [å®Œæ•´çš„Gymç¯å¢ƒï¼Œä¸Startupå®Œå…¨ä¸€è‡´]
â”‚
â”œâ”€â”€ ğŸ® Game Area (ç½‘ç»œæ¨¡å¼é…ç½®)
â”‚   â”œâ”€â”€ GameModeManager (è®¾ç½®ä¸ºNetworkæ¨¡å¼)
â”‚   â”œâ”€â”€ Table (ç½‘ç»œç»„ä»¶å¯ç”¨)
â”‚   â”œâ”€â”€ Ball System (ç½‘ç»œç®¡ç†å¯ç”¨)
â”‚   â””â”€â”€ Paddle System (ç½‘ç»œæ§åˆ¶å¯ç”¨)
â”‚
â””â”€â”€ ğŸŒ Network Systems (ç½‘ç»œä¸“ç”¨)
    â”œâ”€â”€ NetworkManager
    â”œâ”€â”€ SpawnManager
    â””â”€â”€ NetworkSession
```

### ç¬¬ä¸‰é˜¶æ®µï¼šå®ç°æ— ç¼åˆ‡æ¢

#### 1. GameModeManager é…ç½®

åœ¨ Startup åœºæ™¯ä¸­é…ç½® GameModeManagerï¼š

```csharp
// åœ¨Inspectorä¸­åˆ†é…
GameModeManageré…ç½®ï¼š
â”œâ”€â”€ Current Mode: Local
â”œâ”€â”€ Enable Mode Transition: true
â”œâ”€â”€ Game Area Root: [Game Area GameObject]
â”œâ”€â”€ Environment Root: [SharedEnvironment GameObject]
â”œâ”€â”€ Local Mode Components:
â”‚   â”œâ”€â”€ TableLocalController
â”‚   â”œâ”€â”€ BallLocalManager
â”‚   â””â”€â”€ LocalPaddleControllers[]
â””â”€â”€ Network Mode Components:
    â”œâ”€â”€ TableNetworkController
    â”œâ”€â”€ BallNetworkManager
    â””â”€â”€ NetworkPaddleControllers[]
```

#### 2. æ¨¡å¼åˆ‡æ¢è§¦å‘

```csharp
// åœ¨MainMenuPanelä¸­æ·»åŠ 
public class MainMenuPanel : MonoBehaviour
{
    public void OnSinglePlayerClicked()
    {
        // ç¡®ä¿æ˜¯å•æœºæ¨¡å¼
        GameModeManager.Instance.SwitchToLocalMode();

        // å¼€å§‹å•æœºæ¸¸æˆ
        StartLocalGame();
    }

    public void OnMultiplayerClicked()
    {
        // åˆ‡æ¢åˆ°ç½‘ç»œæ¨¡å¼
        GameModeManager.Instance.SwitchToNetworkMode();

        // åŠ è½½Gymåœºæ™¯æˆ–å¼€å§‹ç½‘ç»œè¿æ¥
        PHApplication.Instance.NavigationController.LoadArena();
    }
}
```

## ğŸ”§ å…·ä½“æ“ä½œæ­¥éª¤

### ç«‹å³å¯æ‰§è¡Œçš„æ­¥éª¤

#### Step 1: ä½¿ç”¨ SharedEnvironment é¢„åˆ¶ä½“

```bash
âœ… ç®€åŒ–æ“ä½œï¼šä½¿ç”¨å·²åˆ›å»ºçš„é¢„åˆ¶ä½“

1. æ‰“å¼€ Startup.unity åœºæ™¯
2. ä» Project çª—å£æ‹–æ‹½ SharedEnvironment.prefab åˆ° Hierarchy
3. è°ƒæ•´ä½ç½®åˆ° (0, 0, 0) ç¡®ä¿ä¸Gymåœºæ™¯ä¸€è‡´
4. éªŒè¯æ‰€æœ‰ç¯å¢ƒç»„ä»¶æ­£å¸¸åŠ è½½ï¼š
   âœ“ Architecture (å»ºç­‘ç»“æ„)
   âœ“ Gym Equipment (ä½“è‚²å™¨æ)
   âœ“ Lighting System (ç¯å…‰ç³»ç»Ÿ)
   âœ“ Audio Systems (éŸ³é¢‘ç³»ç»Ÿ)
   âœ“ Post Processing (åå¤„ç†)
```

#### Step 2: è®¾ç½® GameModeManager

```bash
1. åœ¨Startupåœºæ™¯åˆ›å»ºç©ºGameObjectï¼Œå‘½å"GameModeManager"
2. æ·»åŠ GameModeManagerè„šæœ¬
3. åœ¨Inspectorä¸­ç‚¹å‡»"Auto Assign References"
4. æ‰‹åŠ¨åˆ†é…Local Mode Componentså’ŒNetwork Mode Components
5. è®¾ç½®Current Modeä¸ºLocal
```

#### Step 3: é…ç½®åŒæ¨¡å¼ç»„ä»¶

å¯¹æ¯ä¸ªæ¸¸æˆå¯¹è±¡ï¼ˆTableã€Ballã€Paddleï¼‰ï¼Œæ·»åŠ ä¸¤å¥—ç»„ä»¶ï¼š

- æœ¬åœ°æ§åˆ¶ç»„ä»¶ï¼ˆå¯ç”¨ï¼‰
- ç½‘ç»œæ§åˆ¶ç»„ä»¶ï¼ˆç¦ç”¨ï¼‰

#### Step 4: æµ‹è¯•æ¨¡å¼åˆ‡æ¢

```csharp
// åœ¨è¿è¡Œæ—¶æµ‹è¯•
public void TestModeSwitching()
{
    // æµ‹è¯•åˆ‡æ¢åˆ°ç½‘ç»œæ¨¡å¼
    GameModeManager.Instance.SwitchToNetworkMode();

    // ç­‰å¾…2ç§’
    await Task.Delay(2000);

    // åˆ‡æ¢å›æœ¬åœ°æ¨¡å¼
    GameModeManager.Instance.SwitchToLocalMode();
}
```

## âœ… ä¼˜åŠ¿æ€»ç»“

### ğŸ® ç”¨æˆ·ä½“éªŒ

- **å³æ—¶ä½“éªŒ**ï¼šå¯åŠ¨åç«‹å³ç½®èº«å®Œæ•´è™šæ‹Ÿæˆ¿é—´
- **æ— ç¼åˆ‡æ¢**ï¼šæ¨¡å¼åˆ‡æ¢æ— åŠ è½½æ—¶é—´
- **ä¸€è‡´æ€§**ï¼šä¸¤ç§æ¨¡å¼ä¸‹ç¯å¢ƒå®Œå…¨ä¸€è‡´

### ğŸš€ æ€§èƒ½ä¼˜åŒ–

- **é›¶é‡å¤åˆå§‹åŒ–**ï¼šç¯å¢ƒå¯¹è±¡ä»ä¸é”€æ¯é‡å»º
- **ç»„ä»¶å¤ç”¨**ï¼šåŒä¸€æ¸¸æˆå¯¹è±¡çš„ä¸åŒç»„ä»¶çŠ¶æ€
- **å†…å­˜æ•ˆç‡**ï¼šå…±äº«ç¯å¢ƒèµ„æºï¼Œæ— é‡å¤åŠ è½½

### ğŸ› ï¸ å¼€å‘æ•ˆç‡

- **ç»´æŠ¤ç®€å•**ï¼šç¯å¢ƒä¿®æ”¹ä¸€æ¬¡ï¼Œä¸¤å¤„ç”Ÿæ•ˆ
- **è°ƒè¯•å‹å¥½**ï¼šå¯åœ¨å•ä¸€åœºæ™¯æµ‹è¯•ä¸¤ç§æ¨¡å¼
- **æ‰©å±•å®¹æ˜“**ï¼šæ·»åŠ æ–°æ¨¡å¼åªéœ€æ‰©å±• GameModeManager

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³æ‰§è¡Œ**ï¼ˆä»Šå¤©ï¼‰ï¼š

1. âœ… å¤åˆ¶å®Œæ•´ç¯å¢ƒåˆ° Startup åœºæ™¯
2. âœ… é…ç½® GameModeManager
3. âœ… æµ‹è¯•åŸºç¡€æ¨¡å¼åˆ‡æ¢

**åç»­ä¼˜åŒ–**ï¼ˆæœ¬å‘¨ï¼‰ï¼š

1. ğŸ”„ åˆ›å»º Environment é¢„åˆ¶ä½“
2. ğŸ”„ å®Œå–„åŒæ¨¡å¼ç»„ä»¶
3. ğŸ”„ é›†æˆåˆ° UI ç³»ç»Ÿ

**é«˜çº§åŠŸèƒ½**ï¼ˆä¸‹å‘¨ï¼‰ï¼š

1. ğŸ¨ æ·»åŠ æ¨¡å¼åˆ‡æ¢åŠ¨ç”»
2. ğŸ”Š é…ç½®ç¯å¢ƒéŸ³æ•ˆ
3. ğŸ’¾ ä¿å­˜æ¨¡å¼åå¥½è®¾ç½®

è¿™ä¸ªæ–¹æ¡ˆè®©ä½ æ—¢èƒ½ç«‹å³åœ¨ Startup åœºæ™¯ä¸­äº«å—å®Œæ•´çš„è™šæ‹Ÿæˆ¿é—´ä½“éªŒï¼Œåˆèƒ½æ— ç¼åˆ‡æ¢åˆ°å¤šäººæ¨¡å¼ï¼Œé¿å…äº†ä»»ä½•é‡å¤åˆå§‹åŒ–çš„æ€§èƒ½æŸå¤±ã€‚
